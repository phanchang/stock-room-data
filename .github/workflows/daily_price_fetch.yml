name: Daily Price & Strategy
on:
  schedule:
    - cron: '0 7 * * 1-5' # å°åŒ— 15:00
  workflow_dispatch:

jobs:
  run-daily:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with: { python-version: '3.11' }
      - name: Install dependencies
        run: pip install pandas yfinance lxml python-dotenv numpy pyarrow
      - name: Fetch Price & Run Strategy
        run: |
          python scripts/init_cache_tw.py --auto
          python scripts/daily_strategy_runner.py
      - name: Commit and Push Results
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 1. åªåŠ å…¥ä»Šå¤©ä¸‹åˆç”¢å‡ºçš„æŒ‡æ¨™çµæœ
          git add data/indicators/
          
          # 2. æäº¤æŒ‡æ¨™ã€‚å¦‚æœæ²’æª”æ¡ˆè®Šå‹•ï¼ˆä¾‹å¦‚ä»Šå¤©ä¼‘å¸‚ï¼‰å°±ç›´æ¥çµæŸ
          git commit -m "Auto: Update Daily Strategy Indicators" || { echo "No changes to commit"; exit 0; }
          
          # 3. ğŸŸ¢ é—œéµï¼šæ—¢ç„¶æ¸…å–®é€±æ—¥æ‰æ›´æ–°ï¼Œå¹³æ—¥ä¸‹åˆç”¢ç”Ÿçš„ä»»ä½•å° stock_list æˆ– cache çš„è®Šå‹•
          # æˆ‘å€‘é€šé€šä¸è¦å­˜ã€‚reset --hard æœƒæŠŠå®ƒå€‘æ¸…ä¹¾æ·¨ï¼Œä¿è­‰ä¸‹ä¸€æ­¥ pull é †åˆ©ã€‚
          git reset --hard HEAD
          
          # 4. æ‹‰å–é ç«¯ï¼ˆåŒ…å«æ˜¨æ™šçš„ç‡Ÿæ”¶æˆ–ä¸Šé€±æ—¥çš„æ¸…å–®ï¼‰ä¸¦æ¨å›
          git pull --rebase origin main
          git push origin main