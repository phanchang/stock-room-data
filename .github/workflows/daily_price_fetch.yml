name: Daily Price & Strategy
on:
  schedule:
    - cron: '0 7 * * 1-5' # å°åŒ— 15:00
  workflow_dispatch:

jobs:
  run-daily:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with: { python-version: '3.11' }
      - name: Install dependencies
        run: pip install pandas yfinance lxml python-dotenv numpy pyarrow
      - name: Fetch Price & Run Strategy
        run: |
          python scripts/init_cache_tw.py --auto
          python scripts/daily_strategy_runner.py
      - name: Commit and Push Results
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 1. ä¿å­˜é‡è¦è³‡æ–™ (ä½¿ç”¨ -f å¼·åˆ¶åŠ å…¥ï¼Œç„¡è¦– .gitignore)
          git add -f data/indicators/
          git add -f data/cache/tw/
          git add -f data/stock_list.csv
          
          # 2. æäº¤ (å…ˆå­˜æª”ï¼Œç¢ºä¿è³‡æ–™å®‰å…¨)
          git commit -m "Auto: Update Price, Strategy & Stock List" || { echo "No changes to commit"; exit 0; }
          
          # 3. ğŸŸ¢ æ¸…ç†æˆ°å ´ï¼šæŠŠå‰©ä¸‹æ²’ add çš„é›œæª”æ¸…æ‰ï¼Œè®“ç‹€æ…‹è®Šä¹¾æ·¨
          # é€™æ˜¯ç‚ºäº†è§£æ±º "unstaged changes" å ±éŒ¯çš„é—œéµä¸€æ­¥
          git reset --hard
          
          # 4. èåˆé›²ç«¯è³‡æ–™ (è™•ç†èˆ‡ fund_sync çš„æ™‚é–“å·®è¡çª)
          git pull --rebase origin main
          
          # 5. æ¨é€
          git push origin main