name: Daily Price & Strategy
on:
  schedule:
    - cron: '0 7 * * 1-5' # å°åŒ— 15:00
  workflow_dispatch:

jobs:
  run-daily:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with: { python-version: '3.11' }
      - name: Install dependencies
        run: pip install pandas yfinance lxml python-dotenv numpy pyarrow
      - name: Fetch Price & Run Strategy
        run: |
          python scripts/init_cache_tw.py --auto
          python scripts/daily_strategy_runner.py
      - name: Commit and Push Results
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # ğŸŸ¢ ä¿®æ­£ï¼šå¼·åˆ¶åŠ å…¥ K ç·šå¿«å–ã€æŒ‡æ¨™çµæœèˆ‡è‚¡ç¥¨æ¸…å–®
          # ä½¿ç”¨ -f (force) ç¢ºä¿å³ä½¿è¢« .gitignore å¿½ç•¥ä¹Ÿèƒ½å¼·åˆ¶åŠ å…¥ï¼Œç¢ºä¿ Desktop App ä¸‹è¼‰å¾—åˆ°
          git add -f data/indicators/
          git add -f data/cache/tw/
          git add -f data/stock_list.csv
          
          # é¡¯ç¤ºç‹€æ…‹æ–¹ä¾¿é™¤éŒ¯
          git status
          
          # æäº¤ (Commit) - é€™æ¨£å°±ä¸æœƒè¢«è¦–ç‚º unstaged changes é˜»æ“‹ pull
          git commit -m "Auto: Update Price, Strategy & Stock List" || { echo "No changes to commit"; exit 0; }
          
          # æ‹‰å–é ç«¯æ›´æ–° (Rebase)
          git pull --rebase origin main
          
          # æ¨é€
          git push origin main